<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O-Levels Cloud Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --red: #d32f2f; --dark: #1a1a1a; --light: #f8d7da; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; margin: 0; }
        header { background: var(--red); color: white; padding: 20px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .container { max-width: 800px; margin: 30px auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .toolbar { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .filters button { background: white; border: 1px solid var(--red); color: var(--red); padding: 8px 15px; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .filters button.active { background: var(--red); color: white; }
        .btn-delete { background: var(--dark); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; padding: 15px; background: #eee; color: #555; }
        td { padding: 15px; border-bottom: 1px solid #eee; }
        .row-red { background: var(--light); color: #721c24; font-weight: bold; }
        .row-green { background: #d4edda; color: #155724; font-weight: bold; }
        .row-summary { border-left: 5px solid var(--red); font-weight: 900; background: #f1f1f1; }
    </style>
</head>
<body>
<header><h1>LIVE.OLEVELS CLOUD PORTAL</h1></header>
<div class="container">
    <div class="toolbar">
        <div class="filters" id="filter-btns">
            <button class="active" onclick="loadData('day', this)">Today</button>
            <button onclick="loadData('week', this)">Week</button>
            <button onclick="loadData('month', this)">Month</button>
        </div>
        <button class="btn-delete" onclick="clearData()"><i class="fas fa-trash"></i> Clear History</button>
    </div>
    <table>
        <thead><tr><th>Time</th><th>Attentiveness Report</th></tr></thead>
        <tbody id="table-body"></tbody>
    </table>
</div>

<script>
    async function loadData(filter, btn) {
        document.querySelectorAll('#filter-btns button').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        
        const res = await fetch(`/api/get?filter=${filter}`);
        const data = await res.json();
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = "";

        data.forEach(row => {
            const tr = document.createElement('tr');
            const time = new Date(row.created_at).toLocaleString();
            
            if(row.status.includes("SUMMARY") || row.status.includes("5 MIN")) tr.className = "row-summary";
            const isBad = row.status.includes("Not");
            tr.innerHTML = `<td>${time}</td><td class="${isBad ? 'row-red' : 'row-green'}">${row.status}</td>`;
            tbody.appendChild(tr);
        });
    }

    async function clearData() {
        if(confirm("Delete everything?")) {
            await fetch('/api/clear', { method: 'DELETE' });
            loadData('day');
        }
    }
    loadData('day');
</script>
</body>
</html>